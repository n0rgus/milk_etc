{% extends "base.html" %}
{% block content %}
<div class="d-flex justify-content-between align-items-center mb-3">
  <div>
    <div class="h5 mb-1">Buy list (best store by today's price)</div>
    <div class="muted small">Items flagged “WAIT” are predicted to be near a discount window (based on your history).</div>
  </div>
  <a class="btn btn-outline-secondary" href="/">Back</a>
</div>

{% for store_name, rows in groups.items() %}
<div class="card shadow-sm mb-3">
  <div class="card-header bg-white fw-semibold">{{ store_name }}</div>
  <div class="card-body p-0">
    <div class="table-responsive">
      <table class="table table-sm mb-0 align-middle">
        <thead class="table-light">
          <tr>
            <th>Item</th>
            <th>Category</th>
            <th>Price</th>
            <th>Discount</th>
            <th>Note</th>
          </tr>
        </thead>
        <tbody>
          {% for row in rows %}
          {% set item = row.item %}
          {% set best = row.best %}
          <tr class="{% if row.wait %}table-warning{% endif %}">
            <td>{{ item.name }}</td>
            <td class="muted">{{ item.category or "" }}</td>
            <td class="price">
              {% if best %}
                ${{ "%.2f"|format(best[1]) }}
              {% else %}
                <span class="muted">—</span>
              {% endif %}
            </td>
            <td>
              {% if best and best[2] and best[2].discount_percent %}
                <span class="badge bg-danger pill">-{{ "%.0f"|format(best[2].discount_percent) }}%</span>
              {% else %}
                <span class="muted">—</span>
              {% endif %}
            </td>
            <td class="muted small">
              {% if row.wait %}
                <span class="badge bg-warning text-dark pill">WAIT</span>
              {% endif %}
              {{ row.note }}
            </td>
          </tr>
          {% endfor %}
          {% if rows|length == 0 %}
          <tr><td colspan="5" class="muted small p-3">No items in this group yet.</td></tr>
          {% endif %}
        </tbody>
      </table>
    </div>
  </div>
</div>
{% endfor %}
{% endblock %}
